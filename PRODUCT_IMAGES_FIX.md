# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ç–æ–≤–∞—Ä–æ–≤

## üî¥ –ü—Ä–æ–±–ª–µ–º–∞

–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å –≤ Mini App –∏ –∏–Ω–æ–≥–¥–∞ –ø—Ä–æ–ø–∞–¥–∞–ª–∏ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è.

### –°–∏–º–ø—Ç–æ–º—ã
- –§–æ—Ç–æ —Ä–∞–±–æ—Ç–∞–ª–æ –∫–∞–∫–æ–µ-—Ç–æ –≤—Ä–µ–º—è, –ø–æ—Ç–æ–º –∏—Å—á–µ–∑–∞–ª–æ
- –ü–æ—Å–ª–µ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (deploy) –≤—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ –ø—Ä–æ–ø–∞–¥–∞–ª–∏
- –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö —Ñ–æ—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–ª–æ—Å—å, –≤ –¥—Ä—É–≥–∏—Ö - –Ω–µ—Ç

## üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã

### 1. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞: –ø–æ—Ç–µ—Ä—è —Ñ–∞–π–ª–æ–≤ –ø—Ä–∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:**
- –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–ª–∏—Å—å –≤ `/src/backend/static/uploads/products/` **–≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞**
- –ü—Ä–∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (`docker compose build backend`) –≤—Å–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª—è–ª–∏—Å—å
- –í `docker-compose.prod.yml` **–Ω–µ –±—ã–ª–æ volume** –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤

**–ö–æ–≥–¥–∞ —ç—Ç–æ –ø—Ä–æ—è–≤–ª—è–ª–æ—Å—å:**
- –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ `./deploy.sh` —Å –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- –ü–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã `docker compose -f docker-compose.prod.yml build backend`
- –ü—Ä–∏ –ª—é–±–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–¥–∞ backend

### 2. –ù–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ:**
- –í –ë–î —Ç–æ–≤–∞—Ä—ã —Å—Å—ã–ª–∞–ª–∏—Å—å –Ω–∞ —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —É–¥–∞–ª–µ–Ω—ã –ø—Ä–∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–µ
- –ù–∞–ø—Ä–∏–º–µ—Ä: —Ç–æ–≤–∞—Ä —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ `b281626a9e864dd49fc8af911cf5281c.webp`, –Ω–æ —Ñ–∞–π–ª–∞ –Ω–µ—Ç

**–ü–æ—á–µ–º—É —Ç–∞–∫ –ø–æ–ª—É—á–∏–ª–æ—Å—å:**
- –ü—Ä–æ–¥–∞–≤–µ—Ü –∑–∞–≥—Ä—É–∑–∏–ª —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
- –§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω–∏–ª–æ—Å—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
- –ü—É—Ç—å —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è –≤ –ë–î
- –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –¥–µ–ø–ª–æ–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–µ—Ä–µ—Å–æ–±—Ä–∞–ª—Å—è ‚Üí —Ñ–∞–π–ª —É–¥–∞–ª–∏–ª—Å—è
- –í –ë–î –æ—Å—Ç–∞–ª—Å—è –ø—É—Ç—å –∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É —Ñ–∞–π–ª—É

## ‚úÖ –†–µ—à–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ 1: Persistent volume –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ ‚≠ê (–ö–†–ò–¢–ò–ß–ù–û)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `docker-compose.prod.yml`:**

```yaml
services:
  backend:
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ...
    # Persist uploaded product images across container rebuilds
    volumes:
      - static_uploads:/src/backend/static/uploads

volumes:
  pgdata:
  pgdata-replica:
  redis_data:
  static_uploads:  # Persistent storage for uploaded product images
```

**–ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç:**
- ‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ –ù–ï —É–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- ‚úÖ –§–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Docker volume –Ω–∞ —Ö–æ—Å—Ç–µ
- ‚úÖ –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–¥–∞ backend —Ñ–∞–π–ª—ã –æ—Å—Ç–∞—é—Ç—Å—è

### –†–µ—à–µ–Ω–∏–µ 2: Nginx –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ /static/ –∫ backend

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `nginx/nginx.prod.conf`:**

–î–ª—è —Å–µ—Ä–≤–µ—Ä–∞ `api.flurai.ru`:
```nginx
# Static files (product images) - proxy to backend
location /static/ {
    # –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∫ backend, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑–¥–∞–µ—Ç —á–µ—Ä–µ–∑ FastAPI StaticFiles
    proxy_pass http://backend;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ nginx
    proxy_cache_valid 200 30d;
    proxy_cache_bypass $http_pragma $http_authorization;
    expires 30d;
    add_header Cache-Control "public, immutable";

    # –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ç–∞–π–º–∞—É—Ç –¥–ª—è –±–æ–ª—å—à–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    proxy_connect_timeout 10s;
    proxy_send_timeout 30s;
    proxy_read_timeout 30s;
}
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `miniapp/nginx.conf`:**

```nginx
# Product images: proxy to backend (same network in docker-compose)
location /static/ {
    proxy_pass http://backend:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_connect_timeout 10s;
    proxy_send_timeout 30s;
    proxy_read_timeout 30s;
    expires 30d;
    add_header Cache-Control "public, immutable";
}
```

**–ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç:**
- ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ https://api.flurai.ru/static/...
- ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ https://app.flurai.ru/static/...
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤ Telegram Mini App –∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- ‚úÖ Nginx –∫—ç—à–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ 30 –¥–Ω–µ–π

### –†–µ—à–µ–Ω–∏–µ 3: config.json —Å API URL –ø—Ä–∏ —Å–±–æ—Ä–∫–µ

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `miniapp/Dockerfile`:**

```dockerfile
# Build argument for API URL
ARG VITE_API_URL
ARG VITE_BOT_USERNAME

ENV VITE_API_URL=$VITE_API_URL
ENV VITE_BOT_USERNAME=$VITE_BOT_USERNAME

# Ensure config.json has API URL at build time so production never has empty base
RUN echo "{\"apiUrl\":\"${VITE_API_URL}\"}" > public/config.json

# Build the app
RUN npm run build
```

**–ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç:**
- ‚úÖ Frontend –≤—Å–µ–≥–¥–∞ –∑–Ω–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π API URL
- ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≥—Ä—É–∑—è—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞ (api.flurai.ru)
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∏ –≤ Telegram, –∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ health backend
```bash
curl https://api.flurai.ru/health
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{"status": "healthy", "version": "1.0.0", "checks": {"database": "ok", "redis": "ok"}}
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º —á–µ—Ä–µ–∑ api.flurai.ru
```bash
curl -I https://api.flurai.ru/static/uploads/products/509fdc3df38d4f39a60ad9fcf475ef01.webp
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```
HTTP/2 200
content-type: image/webp
cache-control: max-age=2592000
cache-control: public, immutable
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ —á–µ—Ä–µ–∑ app.flurai.ru
```bash
curl -I https://app.flurai.ru/static/uploads/products/509fdc3df38d4f39a60ad9fcf475ef01.webp
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```
HTTP/2 200
content-type: image/webp
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

–û—Ç–∫—Ä—ã—Ç—å: https://app.flurai.ru/shop/123456789

**–ï—Å–ª–∏ —Ñ–æ—Ç–æ –ù–ï –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è:**
1. –û—Ç–∫—Ä—ã—Ç—å DevTools (F12) ‚Üí Network tab
2. –ù–∞–π—Ç–∏ –∑–∞–ø—Ä–æ—Å—ã –∫ `/static/uploads/products/...`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞:
   - **200 OK** ‚Üí —Ñ–æ—Ç–æ –¥–æ–ª–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è
   - **404 Not Found** ‚Üí —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ backend (–ø—Ä–æ–±–ª–µ–º–∞ —Å –ë–î)
   - **CORS error** ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ —Å nginx –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π

## üîß –î–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –¥–µ–ø–ª–æ–µ

### –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –¥–µ–ø–ª–æ–π (–±–µ–∑ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤)

–ë–µ–∑–æ–ø–∞—Å–Ω–æ! –§–∞–π–ª—ã –ù–ï —É–¥–∞–ª—è—Ç—Å—è:
```bash
./deploy.sh "–æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"
```

–ò–ª–∏:
```bash
git push
ssh yandex-cloud "cd ~/flurai && git pull && docker compose -f docker-compose.prod.yml restart backend nginx"
```

### –î–µ–ø–ª–æ–π —Å –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π backend

–¢–µ–ø–µ—Ä—å –±–µ–∑–æ–ø–∞—Å–Ω–æ –±–ª–∞–≥–æ–¥–∞—Ä—è volume! –§–∞–π–ª—ã –ù–ï —É–¥–∞–ª—è—Ç—Å—è:
```bash
ssh yandex-cloud "cd ~/flurai && docker compose -f docker-compose.prod.yml build backend && docker compose -f docker-compose.prod.yml up -d backend"
```

### –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

–§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –≤ volume:
```bash
ssh yandex-cloud "cd ~/flurai && docker compose -f docker-compose.prod.yml down && docker compose -f docker-compose.prod.yml up -d"
```

‚ö†Ô∏è **–í–ê–ñ–ù–û:** –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `docker compose down -v` (—Å —Ñ–ª–∞–≥–æ–º `-v`) - —ç—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ volumes, –≤–∫–ª—é—á–∞—è static_uploads!

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤

### –í Docker volume (production)
```
Docker volume: flurai_static_uploads
‚îú‚îÄ‚îÄ products/
‚îÇ   ‚îú‚îÄ‚îÄ 509fdc3df38d4f39a60ad9fcf475ef01.webp
‚îÇ   ‚îú‚îÄ‚îÄ 8cc0a9d9173845eb804e8352ac54e44c.webp
‚îÇ   ‚îî‚îÄ‚îÄ ... (–¥—Ä—É–≥–∏–µ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–æ–≤)
```

### –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ backend
```
/src/backend/static/uploads/  ‚Üí –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –∏–∑ Docker volume
‚îú‚îÄ‚îÄ products/
‚îÇ   ‚îú‚îÄ‚îÄ *.webp, *.jpg, *.png
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ volume –Ω–∞ —Ö–æ—Å—Ç–µ
```bash
# –°–ø–∏—Å–æ–∫ volumes
docker volume ls | grep static

# –ò–Ω—Å–ø–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å volume
docker volume inspect flurai_static_uploads

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
docker run --rm -v flurai_static_uploads:/data alpine ls -lh /data/products/
```

## üö® –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è —Ñ–æ—Ç–æ –ø—Ä–æ–ø–∞–ª–æ

**–ü—Ä–∏—á–∏–Ω–∞:** –†–∞–Ω—å—à–µ (–¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è) –ø—Ä–∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª—è–ª–∏—Å—å

**–†–µ—à–µ–Ω–∏–µ —Å–µ–π—á–∞—Å:** –§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ volume, –Ω–µ —É–¥–∞–ª—è—é—Ç—Å—è

**–ï—Å–ª–∏ —ç—Ç–æ –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ volume —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:
   ```bash
   docker volume ls | grep static_uploads
   ```
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ backend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç volume:
   ```bash
   docker inspect flurai-backend-1 | grep -A5 Mounts
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: –¢–æ–≤–∞—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–Ω–µ—Ç —Ñ–æ—Ç–æ", –Ω–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –í –ë–î –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å (–Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `/static/`)

**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–∏—Ç—å –ë–î —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∏–ª–∏ SQL:
```sql
-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –ø—É—Ç–∏
SELECT id, name, photo_id, photo_ids FROM products WHERE seller_id = 123456789;

-- –û–±–Ω–æ–≤–∏—Ç—å –ø—É—Ç—å (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
UPDATE products
SET photo_id = '/static/uploads/products/509fdc3df38d4f39a60ad9fcf475ef01.webp',
    photo_ids = '["/static/uploads/products/509fdc3df38d4f39a60ad9fcf475ef01.webp"]'
WHERE id = 1;
```

### –ü—Ä–æ–±–ª–µ–º–∞: –§–æ—Ç–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ Telegram, –Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ

**–ü—Ä–∏—á–∏–Ω–∞:** config.json –ø—É—Å—Ç–æ–π –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
curl https://app.flurai.ru/config.json
```

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```json
{"apiUrl":"https://api.flurai.ru"}
```

**–ï—Å–ª–∏ –ø—É—Å—Ç–æ–π - –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å miniapp:**
```bash
docker compose -f docker-compose.prod.yml build miniapp
docker compose -f docker-compose.prod.yml up -d miniapp
```

### –ü—Ä–æ–±–ª–µ–º–∞: –°—Ç–∞—Ä—ã–µ —Ñ–æ—Ç–æ –æ—Å—Ç–∞–ª–∏—Å—å, –Ω–æ–≤—ã–µ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ volume

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ó–∞–π—Ç–∏ –≤ backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker compose -f docker-compose.prod.yml exec backend bash

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞
ls -la /src/backend/static/uploads/products/

# –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
chmod 755 /src/backend/static/uploads/products/
```

## üìù –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å —Ñ–∞–π–ª—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –±–µ–∑ volume:

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø
docker compose exec backend tar -czf /tmp/static_backup.tar.gz -C /src/backend/static/uploads .

# 2. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ö–æ—Å—Ç
docker cp flurai-backend-1:/tmp/static_backup.tar.gz /tmp/

# 3. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker compose -f docker-compose.prod.yml stop backend
docker compose -f docker-compose.prod.yml rm -f backend

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å volume (volume —Å–æ–∑–¥–∞—Å—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
docker compose -f docker-compose.prod.yml up -d backend

# 5. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª—ã
docker cp /tmp/static_backup.tar.gz flurai-backend-1:/tmp/
docker compose -f docker-compose.prod.yml exec backend tar -xzf /tmp/static_backup.tar.gz -C /src/backend/static/uploads/

# 6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
docker compose -f docker-compose.prod.yml exec backend ls -la /src/backend/static/uploads/products/
```

## ‚úÖ –°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

- ‚úÖ **docker-compose.prod.yml** - –¥–æ–±–∞–≤–ª–µ–Ω volume static_uploads
- ‚úÖ **nginx/nginx.prod.conf** - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ /static/ –¥–ª—è api.flurai.ru
- ‚úÖ **nginx/nginx.prod.conf** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ /static/ –¥–ª—è default server
- ‚úÖ **miniapp/nginx.conf** - –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ /static/ –∫ backend
- ‚úÖ **miniapp/Dockerfile** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è config.json —Å API URL –ø—Ä–∏ —Å–±–æ—Ä–∫–µ
- ‚úÖ **nginx/nginx.conf** - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω –Ω–∞ nginx.prod.conf (production)
- ‚úÖ **Production —Å–µ—Ä–≤–µ—Ä** - backend –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω —Å volume, —Ñ–∞–π–ª—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

## üéØ –ò—Ç–æ–≥

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ **–Ω–∞–¥–µ–∂–Ω–∞** –∏ **—É—Å—Ç–æ–π—á–∏–≤–∞ –∫ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞–º**:

1. ‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ **–ù–ï —É–¥–∞–ª—è—é—Ç—Å—è** –ø—Ä–∏ –¥–µ–ø–ª–æ–µ
2. ‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ **api.flurai.ru** –∏ **app.flurai.ru**
3. ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤ **Telegram Mini App** –∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
4. ‚úÖ Nginx **–∫—ç—à–∏—Ä—É–µ—Ç** –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ 30 –¥–Ω–µ–π
5. ‚úÖ Backend **—Ä–∞–∑–¥–∞–µ—Ç** —Å—Ç–∞—Ç–∏–∫—É —á–µ—Ä–µ–∑ FastAPI StaticFiles
6. ‚úÖ Volume **—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç** —Ñ–∞–π–ª—ã –º–µ–∂–¥—É –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞–º–∏

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 2026-02-15

**–ê–≤—Ç–æ—Ä:** Claude Sonnet 4.5 + –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫

---

*–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–¥–µ–ª "–ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è" –≤—ã—à–µ.*
